<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposta de Engenharia Civil | [Nome do Cliente]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/lucide.min.js"></script>
    <script src="https://unpkg.com/signature_pad"></script>
    <style>
        :root {
            --primary: #0A2463;
            --secondary: #2D3748;
            --accent: #047857;
            --glass-bg-light: rgba(255, 255, 255, 0.5);
            --glass-border-light: rgba(255, 255, 255, 0.7);
            --glass-bg-dark: rgba(45, 55, 72, 0.5);
            --glass-border-dark: rgba(45, 55, 72, 0.7);
        }

        .dark {
            --primary: #E2E8F0;
            --secondary: #A0AEC0;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-card {
            background: var(--glass-bg-light);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border-light);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .dark .glass-card {
            background: var(--glass-bg-dark);
            border: 1px solid var(--glass-border-dark);
        }

        .neumorphic-btn {
            background: #e0e5ec;
            border-radius: 12px;
            box-shadow: 6px 6px 12px #c1c9d2, -6px -6px 12px #ffffff;
            transition: all 0.2s ease-in-out;
        }
        
        .neumorphic-btn:hover {
             box-shadow: 4px 4px 8px #c1c9d2, -4px -4px 8px #ffffff;
        }

        .neumorphic-btn:active {
            box-shadow: inset 4px 4px 8px #c1c9d2, inset -4px -4px 8px #ffffff;
        }
        
        .dark .neumorphic-btn {
            background: #2D3748;
            box-shadow: 6px 6px 12px #212935, -6px -6px 12px #39455b;
        }

        .dark .neumorphic-btn:hover {
            box-shadow: 4px 4px 8px #212935, -4px -4px 8px #39455b;
        }

        .dark .neumorphic-btn:active {
            box-shadow: inset 4px 4px 8px #212935, inset -4px -4px 8px #39455b;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 9999px;
            background-color: #fff;
            border: 4px solid #0A2463;
            z-index: 1;
        }
        .dark .timeline-item::before {
             background-color: #2D3748;
             border-color: #E2E8F0;
        }
        
        .signature-pad {
            border: 2px dashed #CBD5E0;
            border-radius: 0.5rem;
        }

        .dark .signature-pad {
            border-color: #4A5568;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-500">
    <div id="pdf-content" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Cabeçalho da Proposta -->
        <header class="glass-card rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-primary">Proposta de Engenharia</h1>
                    <p class="text-secondary">Serviços de consultoria e projeto estrutural.</p>
                </div>
                 <div class="mt-4 md:mt-0 md:text-right">
                    <p class="font-semibold text-primary" id="client-name-display">Para: Carregando...</p>
                    <p class="text-sm text-secondary" id="issue-date-display">Data: Carregando...</p>
                    <p class="text-sm text-secondary" id="validity-date-display">Validade: Carregando...</p>
                </div>
            </div>
            <button id="theme-toggle" class="absolute top-4 right-4 p-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition">
                <i data-lucide="sun" class="h-5 w-5 block dark:hidden"></i>
                <i data-lucide="moon" class="h-5 w-5 hidden dark:block"></i>
            </button>
        </header>

        <main>
            <!-- Seção de Escopo -->
            <section id="scope" class="mb-12">
                <h2 class="text-2xl font-bold text-primary mb-6">1. Escopo de Serviços</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Cards de Serviço -->
                    <div class="service-card glass-card p-6 rounded-xl transform hover:-translate-y-2">
                        <i data-lucide="building-2" class="w-10 h-10 text-accent mb-4"></i>
                        <h3 class="text-xl font-semibold text-primary">Projeto Estrutural Completo</h3>
                        <p class="text-secondary mt-2">Desenvolvimento detalhado de toda a estrutura, garantindo segurança e otimização de materiais.</p>
                    </div>
                     <div class="service-card glass-card p-6 rounded-xl transform hover:-translate-y-2">
                        <i data-lucide="shield-check" class="w-10 h-10 text-accent mb-4"></i>
                        <h3 class="text-xl font-semibold text-primary">Análise e Laudo Técnico</h3>
                        <p class="text-secondary mt-2">Inspeção e diagnóstico de estruturas existentes para garantir a conformidade e segurança.</p>
                    </div>
                     <div class="service-card glass-card p-6 rounded-xl transform hover:-translate-y-2">
                        <i data-lucide="ruler" class="w-10 h-10 text-accent mb-4"></i>
                        <h3 class="text-xl font-semibold text-primary">Acompanhamento de Obra</h3>
                        <p class="text-secondary mt-2">Visitas técnicas periódicas para assegurar que a execução esteja alinhada com o projeto.</p>
                    </div>
                </div>
            </section>

             <!-- Timeline -->
            <section id="timeline" class="mb-12">
                <h2 class="text-2xl font-bold text-primary mb-8">2. Cronograma de Execução</h2>
                <div class="relative pl-6 border-l-2 border-dashed border-gray-300 dark:border-gray-600">
                    <!-- Itens da Timeline -->
                    <div class="timeline-item mb-10 ml-4">
                        <h3 class="text-lg font-semibold text-primary">Semana 1-2: Análise e Planejamento</h3>
                        <p class="text-secondary">Coleta de dados, estudo de viabilidade e definição das premissas do projeto.</p>
                    </div>
                    <div class="timeline-item mb-10 ml-4">
                        <h3 class="text-lg font-semibold text-primary">Semana 3-5: Desenvolvimento do Projeto</h3>
                        <p class="text-secondary">Modelagem estrutural, cálculos e detalhamento dos elementos.</p>
                    </div>
                    <div class="timeline-item mb-10 ml-4">
                        <h3 class="text-lg font-semibold text-primary">Semana 6: Revisão e Entrega</h3>
                        <p class="text-secondary">Apresentação do projeto final, revisões e entrega das pranchas e documentação.</p>
                    </div>
                     <div class="timeline-item ml-4">
                        <h3 class="text-lg font-semibold text-primary">Pós-Entrega: Suporte Técnico</h3>
                        <p class="text-secondary">Suporte contínuo durante a fase de execução para esclarecimento de dúvidas.</p>
                    </div>
                </div>
            </section>
            
            <!-- Calculadora de Valor e ROI -->
            <section id="investment" class="mb-12">
                <h2 class="text-2xl font-bold text-primary mb-6">3. Investimento e Retorno (ROI)</h2>
                 <div class="glass-card rounded-2xl p-8">
                     <div class="grid md:grid-cols-2 gap-8 items-center">
                         <div>
                            <h3 class="text-xl font-semibold text-primary">Estrutura de Investimento</h3>
                            <p class="text-secondary mb-6">Selecione os serviços para customizar sua proposta.</p>
                             <div id="service-calculator">
                                <label class="flex items-center space-x-3 mb-4">
                                    <input type="checkbox" data-price="15000" class="service-checkbox h-5 w-5 rounded text-accent focus:ring-accent">
                                    <span>Projeto Estrutural (R$ 15.000,00)</span>
                                </label>
                                <label class="flex items-center space-x-3 mb-4">
                                    <input type="checkbox" data-price="5000" class="service-checkbox h-5 w-5 rounded text-accent focus:ring-accent">
                                    <span>Análise e Laudo (R$ 5.000,00)</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="checkbox" data-price="8000" class="service-checkbox h-5 w-5 rounded text-accent focus:ring-accent">
                                    <span>Acompanhamento de Obra (R$ 8.000,00)</span>
                                </label>
                            </div>
                        </div>
                        <div class="text-center bg-gray-100 dark:bg-gray-800 p-8 rounded-lg">
                            <p class="text-lg text-secondary">Investimento Total</p>
                            <p id="total-price" class="text-5xl font-extrabold text-accent my-2">R$ 0,00</p>
                            <p class="text-sm text-secondary">Economia estimada a longo prazo com otimização de materiais e prevenção de erros: <strong class="text-primary" id="roi-value">~R$ 0,00</strong></p>
                        </div>
                     </div>
                </div>
            </section>
            
            <!-- Aceitação e Assinatura -->
            <section id="acceptance">
                <h2 class="text-2xl font-bold text-primary mb-6">4. Termos e Aceitação</h2>
                <div class="glass-card rounded-2xl p-8">
                    <p class="text-secondary mb-6">Ao assinar abaixo, você concorda com os termos, escopo e valores apresentados nesta proposta. Um contrato formal será enviado em seguida.</p>
                    <div class="w-full mx-auto bg-white dark:bg-gray-800 rounded-lg p-4">
                         <canvas id="signature-canvas" class="signature-pad w-full h-48"></canvas>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-6">
                        <button id="clear-signature" class="w-full sm:w-auto neumorphic-btn text-secondary dark:text-gray-200 font-semibold py-3 px-6 flex items-center justify-center gap-2">
                            <i data-lucide="eraser" class="w-5 h-5"></i>
                            Limpar
                        </button>
                        <button id="accept-proposal" class="w-full sm:w-auto bg-accent text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2">
                             <i data-lucide="check-circle" class="w-5 h-5"></i>
                            Aceitar e Baixar PDF
                        </button>
                    </div>
                    <div id="loading-indicator" class="hidden text-center mt-4">
                        <p>Gerando PDF, por favor aguarde...</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicialização de ícones
            lucide.createIcons();
            
            // --- LÓGICA DO TEMA (DARK/LIGHT) ---
            const themeToggle = document.getElementById('theme-toggle');
            const htmlEl = document.documentElement;
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                htmlEl.classList.add('dark');
            }

            themeToggle.addEventListener('click', () => {
                htmlEl.classList.toggle('dark');
                localStorage.setItem('theme', htmlEl.classList.contains('dark') ? 'dark' : 'light');
            });

            // --- DADOS DINÂMICOS DA PROPOSTA ---
            const params = new URLSearchParams(window.location.search);
            const clientName = params.get('cliente') || 'Nome do Cliente';
            const issueDate = new Date();
            const validityDate = new Date();
            validityDate.setDate(issueDate.getDate() + 15); // Validade de 15 dias

            const formatDate = (date) => date.toLocaleDateString('pt-BR');

            document.getElementById('client-name-display').textContent = `Para: ${clientName}`;
            document.getElementById('issue-date-display').textContent = `Data: ${formatDate(issueDate)}`;
            document.getElementById('validity-date-display').textContent = `Validade: ${formatDate(validityDate)}`;
            document.title = `Proposta de Engenharia | ${clientName}`;

            // --- CALCULADORA DE VALOR ---
            const checkboxes = document.querySelectorAll('.service-checkbox');
            const totalPriceEl = document.getElementById('total-price');
            const roiValueEl = document.getElementById('roi-value');

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            };
            
            const updatePrice = () => {
                let total = 0;
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        total += parseFloat(cb.dataset.price);
                    }
                });
                const roi = total * 1.5; // ROI estimado em 150%
                totalPriceEl.textContent = formatCurrency(total);
                roiValueEl.textContent = `~${formatCurrency(roi)}`;
            };
            
            checkboxes.forEach(cb => cb.addEventListener('change', updatePrice));
            updatePrice();

            // --- ANIMAÇÕES COM GSAP ---
            gsap.registerPlugin(ScrollTrigger);
            gsap.from("header", { duration: 0.8, y: -100, opacity: 0, ease: "power3.out" });
            
            const sections = gsap.utils.toArray('section');
            sections.forEach(section => {
                gsap.from(section, {
                    y: 50,
                    opacity: 0,
                    duration: 0.8,
                    ease: "power3.out",
                    scrollTrigger: {
                        trigger: section,
                        start: "top 80%",
                        toggleActions: "play none none none"
                    }
                });
            });

            gsap.from(".service-card", {
                duration: 0.5,
                scale: 0.9,
                opacity: 0,
                stagger: 0.2,
                ease: "back.out(1.7)",
                scrollTrigger: {
                    trigger: "#scope",
                    start: "top 70%"
                }
            });

             gsap.from(".timeline-item", {
                duration: 0.6,
                x: -50,
                opacity: 0,
                stagger: 0.3,
                ease: "power3.out",
                scrollTrigger: {
                    trigger: "#timeline",
                    start: "top 70%"
                }
            });

            // --- LÓGICA DA ASSINATURA DIGITAL ---
            const canvas = document.getElementById('signature-canvas');
            const signaturePad = new SignaturePad(canvas, {
                 backgroundColor: htmlEl.classList.contains('dark') ? 'rgb(31 41 55)' : 'rgb(255, 255, 255)'
            });
            
            // Redimensionar canvas para telas de alta densidade
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear(); // Limpa a assinatura após redimensionar
            }
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();

            document.getElementById('clear-signature').addEventListener('click', () => {
                signaturePad.clear();
            });

            // --- GERAÇÃO DE PDF ---
            const acceptBtn = document.getElementById('accept-proposal');
            const loadingIndicator = document.getElementById('loading-indicator');

            acceptBtn.addEventListener('click', async () => {
                if (signaturePad.isEmpty()) {
                    alert("Por favor, forneça sua assinatura para aceitar a proposta.");
                    return;
                }
                
                loadingIndicator.classList.remove('hidden');
                acceptBtn.disabled = true;

                try {
                    // Esperar um pouco para o UI atualizar
                    await new Promise(resolve => setTimeout(resolve, 100));

                    const proposalContent = document.getElementById('pdf-content');
                    const canvasImage = await html2canvas(proposalContent, {
                        scale: 2, // Melhor qualidade de imagem
                        useCORS: true,
                        backgroundColor: htmlEl.classList.contains('dark') ? '#111827' : '#f3f4f6'
                    });
                    const imgData = canvasImage.toDataURL('image/png');
                    
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: 'p',
                        unit: 'mm',
                        format: 'a4'
                    });

                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvasImage.width;
                    const imgHeight = canvasImage.height;
                    const ratio = imgWidth / imgHeight;
                    const canvasPdfWidth = pdfWidth;
                    const canvasPdfHeight = canvasPdfWidth / ratio;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, canvasPdfWidth, canvasPdfHeight);
                    pdf.save(`Proposta-${clientName.replace(/\s/g, '_')}.pdf`);

                } catch (error) {
                    console.error("Erro ao gerar o PDF:", error);
                    alert("Ocorreu um erro ao gerar o PDF. Tente novamente.");
                } finally {
                    loadingIndicator.classList.add('hidden');
                    acceptBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
